# çƒ­ç‚¹æ–‡ç« å®æ—¶æ›´æ–°ä¸šåŠ¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [ä¸šåŠ¡æ¦‚è¿°](#ä¸šåŠ¡æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
- [ä»£ç å®ç°](#ä»£ç å®ç°)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ¯ ä¸šåŠ¡æ¦‚è¿°

### åŠŸèƒ½æè¿°
å®ç°æ–°é—»æ–‡ç« çš„å®æ—¶é˜…è¯»é‡ç»Ÿè®¡å’Œçƒ­ç‚¹æ’è¡ŒåŠŸèƒ½ï¼Œæ”¯æŒé«˜å¹¶å‘è®¿é—®ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ€§å’Œç³»ç»Ÿæ€§èƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… **å®æ—¶ç»Ÿè®¡**ï¼šç”¨æˆ·ç‚¹å‡»æ–°é—»æ—¶ç«‹å³å¢åŠ é˜…è¯»é‡
- âœ… **çƒ­ç‚¹æ’è¡Œ**ï¼šæŒ‰é˜…è¯»é‡è‡ªåŠ¨æ’åºæ˜¾ç¤ºæœ€çƒ­é—¨æ–‡ç« 
- âœ… **é«˜æ€§èƒ½**ï¼šRedisç¼“å­˜ + MySQLæŒä¹…åŒ–æ¶æ„
- âœ… **æ•°æ®å®‰å…¨**ï¼šå®šæ—¶åŒæ­¥ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šç‚¹å‡»å³æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°é¡µé¢
- âœ… **é˜²åˆ·æœºåˆ¶**ï¼šIPé™åˆ¶é˜²æ­¢æ¶æ„åˆ·é‡ï¼Œç¡®ä¿æ•°æ®çœŸå®æ€§

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ Vue.js   â”‚    â”‚   åç«¯ Spring   â”‚    â”‚   æ•°æ®å­˜å‚¨å±‚    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ–°é—»åˆ—è¡¨  â”‚  â”‚    â”‚  â”‚ æ§åˆ¶å™¨å±‚  â”‚  â”‚    â”‚  â”‚   Redis   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ çƒ­ç‚¹æ’è¡Œ  â”‚  â”‚â—„â”€â”€â”€â”¤  â”‚ æœåŠ¡å±‚    â”‚  â”‚â—„â”€â”€â”€â”¤  â”‚   MySQL   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç‚¹å‡»ç»Ÿè®¡  â”‚  â”‚    â”‚  â”‚ å®šæ—¶ä»»åŠ¡  â”‚  â”‚    â”‚  â”‚ æ•°æ®åŒæ­¥  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**ï¼šVue.js 2.x + Element UI
- **åç«¯**ï¼šSpring Boot + Spring Security
- **ç¼“å­˜**ï¼šRedis 6.x
- **æ•°æ®åº“**ï¼šMySQL 8.0
- **å®šæ—¶ä»»åŠ¡**ï¼šQuartz + Spring Task
- **æ„å»ºå·¥å…·**ï¼šMaven

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. å‰ç«¯ç»„ä»¶

#### æ–°é—»æ˜¾ç¤ºé¡µé¢ (`news-display/index.vue`)
```javascript
// æ ¸å¿ƒè®¡ç®—å±æ€§
computed: {
  // å¤´æ¡æ–°é—»åˆ—è¡¨
  featuredNewsList() {
    return this.newsList.filter(news => news.isFeatured === 'Y')
  },
  
  // æ™®é€šæ–°é—»åˆ—è¡¨
  normalNewsList() {
    return this.newsList.filter(news => news.isFeatured !== 'Y')
  },
  
  // çƒ­ç‚¹æ’è¡Œåˆ—è¡¨ï¼ˆæŒ‰é˜…è¯»é‡æ’åºï¼‰
  hotNewsList() {
    return this.newsList
      .slice()
      .sort((a, b) => (b.views || 0) - (a.views || 0))
      .slice(0, 10)
  }
}
```

#### APIæœåŠ¡ (`api/website/news.js`)
```javascript
// å¢åŠ æ–°é—»é˜…è¯»é‡
export function incrementNewsViews(newsId) {
  return request({
    url: '/website/news/views/' + newsId,
    method: 'post',
    headers: { isToken: false }
  })
}

// è·å–æ–°é—»é˜…è¯»é‡
export function getNewsViews(newsId) {
  return request({
    url: '/website/news/views/' + newsId,
    method: 'get',
    headers: { isToken: false }
  })
}
```

### 2. åç«¯ç»„ä»¶

#### æ§åˆ¶å™¨å±‚ (`WebsiteNewsController.java`)
```java
@RestController
@RequestMapping("/website/news")
public class WebsiteNewsController extends BaseController {
    
    @Autowired
    private WebsiteNewsViewsService websiteNewsViewsService;
    
    /**
     * å¢åŠ æ–°é—»é˜…è¯»é‡ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€æƒé™ï¼Œå¸¦é˜²åˆ·é™åˆ¶ï¼‰
     */
    @Anonymous
    @PostMapping("/views/{newsId}")
    public AjaxResult incrementViews(@PathVariable("newsId") Long newsId, HttpServletRequest request) {
        String clientIp = getClientIpAddress(request);
        Long views = websiteNewsViewsService.incrementViewsWithLimit(newsId, clientIp);
        return AjaxResult.success("é˜…è¯»é‡å¢åŠ æˆåŠŸ", views);
    }
    
    /**
     * è·å–å®¢æˆ·ç«¯çœŸå®IPåœ°å€
     */
    private String getClientIpAddress(HttpServletRequest request) {
        // æ”¯æŒå¤šç§ä»£ç†ç¯å¢ƒä¸‹çš„çœŸå®IPè·å–
        String xForwardedFor = request.getHeader("X-Forwarded-For");
        if (xForwardedFor != null && !xForwardedFor.isEmpty() && !"unknown".equalsIgnoreCase(xForwardedFor)) {
            return xForwardedFor.split(",")[0].trim();
        }
        // ... å…¶ä»–IPè·å–é€»è¾‘
        return request.getRemoteAddr();
    }
    
    /**
     * è·å–æ–°é—»é˜…è¯»é‡ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€æƒé™ï¼‰
     */
    @Anonymous
    @GetMapping("/views/{newsId}")
    public AjaxResult getViews(@PathVariable("newsId") Long newsId) {
        Long views = websiteNewsViewsService.getViews(newsId);
        return AjaxResult.success(views);
    }
}
```

#### æœåŠ¡å±‚ (`WebsiteNewsViewsService.java`)
```java
public interface WebsiteNewsViewsService {
    /**
     * å¢åŠ æ–°é—»é˜…è¯»é‡
     */
    Long incrementViews(Long newsId);
    
    /**
     * å¢åŠ æ–°é—»é˜…è¯»é‡ï¼ˆå¸¦é˜²åˆ·é™åˆ¶ï¼‰
     */
    Long incrementViewsWithLimit(Long newsId, String clientIp);
    
    /**
     * è·å–æ–°é—»é˜…è¯»é‡
     */
    Long getViews(Long newsId);
    
    /**
     * åŒæ­¥Redisé˜…è¯»é‡åˆ°MySQL
     */
    void syncViewsToDatabase(Long newsId);
    
    /**
     * æ‰¹é‡åŒæ­¥æ‰€æœ‰æ–°é—»é˜…è¯»é‡åˆ°MySQL
     */
    void syncAllViewsToDatabase();
}
```

#### æœåŠ¡å®ç°å±‚ (`WebsiteNewsViewsServiceImpl.java`)
```java
@Service
public class WebsiteNewsViewsServiceImpl implements WebsiteNewsViewsService {
    
    @Autowired
    private RedisCache redisCache;
    
    @Autowired
    private WebsiteNewsMapper websiteNewsMapper;
    
    private static final String NEWS_VIEWS_KEY_PREFIX = "news:views:";
    private static final String VIEW_LIMIT_KEY_PREFIX = "news:view_limit:";
    private static final long VIEWS_CACHE_EXPIRE = 7 * 24 * 60 * 60; // 7å¤©
    private static final long VIEW_LIMIT_EXPIRE = 60 * 60; // 1å°æ—¶
    
    @Override
    public Long incrementViews(Long newsId) {
        if (newsId == null) return 0L;
        
        String key = NEWS_VIEWS_KEY_PREFIX + newsId;
        Long views = redisCache.increment(key);
        redisCache.expire(key, VIEWS_CACHE_EXPIRE);
        
        return views;
    }
    
    /**
     * å¢åŠ æ–°é—»é˜…è¯»é‡ï¼ˆå¸¦é˜²åˆ·é™åˆ¶ï¼‰
     */
    public Long incrementViewsWithLimit(Long newsId, String clientIp) {
        if (newsId == null || clientIp == null) return 0L;
        
        // ç”Ÿæˆé˜²åˆ·é™åˆ¶keyï¼šIP + æ–°é—»ID
        String limitKey = VIEW_LIMIT_KEY_PREFIX + clientIp + ":" + newsId;
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»è®¿é—®è¿‡
        if (redisCache.hasKey(limitKey)) {
            // å·²ç»è®¿é—®è¿‡ï¼Œè¿”å›å½“å‰é˜…è¯»é‡ä½†ä¸å¢åŠ 
            return getViews(newsId);
        }
        
        // è®¾ç½®é˜²åˆ·é™åˆ¶
        redisCache.setCacheObject(limitKey, "1", (int)VIEW_LIMIT_EXPIRE, TimeUnit.SECONDS);
        
        // å¢åŠ é˜…è¯»é‡
        return incrementViews(newsId);
    }
    
    @Override
    public Long getViews(Long newsId) {
        if (newsId == null) return 0L;
        
        String key = NEWS_VIEWS_KEY_PREFIX + newsId;
        Object views = redisCache.getCacheObject(key);
        
        if (views == null) {
            // ä»æ•°æ®åº“è·å–å¹¶åŒæ­¥åˆ°Redis
            WebsiteNews news = websiteNewsMapper.selectWebsiteNewsByNewsId(newsId);
            if (news != null && news.getViews() != null) {
                redisCache.setCacheObject(key, news.getViews(), 
                    (int)VIEWS_CACHE_EXPIRE, TimeUnit.SECONDS);
                return news.getViews();
            }
            return 0L;
        }
        
        return Long.valueOf(views.toString());
    }
    
    @Override
    public void syncAllViewsToDatabase() {
        Collection<String> keys = redisCache.keys(NEWS_VIEWS_KEY_PREFIX + "*");
        
        for (String key : keys) {
            String newsIdStr = key.substring(NEWS_VIEWS_KEY_PREFIX.length());
            try {
                Long newsId = Long.valueOf(newsIdStr);
                syncViewsToDatabase(newsId);
            } catch (NumberFormatException e) {
                continue;
            }
        }
    }
}
```

#### å®šæ—¶ä»»åŠ¡ (`RyTask.java`)
```java
@Component("ryTask")
public class RyTask {
    
    @Autowired
    private WebsiteNewsViewsService websiteNewsViewsService;
    
    /**
     * åŒæ­¥æ–°é—»é˜…è¯»é‡åˆ°æ•°æ®åº“
     */
    public void syncNewsViews() {
        try {
            websiteNewsViewsService.syncAllViewsToDatabase();
            System.out.println("æ–°é—»é˜…è¯»é‡åŒæ­¥ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ");
        } catch (Exception e) {
            System.err.println("æ–°é—»é˜…è¯»é‡åŒæ­¥ä»»åŠ¡æ‰§è¡Œå¤±è´¥: " + e.getMessage());
        }
    }
}
```

### 3. æ•°æ®å±‚

#### Redisç¼“å­˜é…ç½®
```yaml
# application.yml
spring:
  redis:
    host: localhost
    port: 6379
    database: 0
    password:
    timeout: 10s
    lettuce:
      pool:
        min-idle: 0
        max-idle: 8
        max-active: 8
        max-wait: -1ms
```

#### MySQLè¡¨ç»“æ„
```sql
-- æ–°é—»è¡¨
CREATE TABLE website_news (
  news_id         bigint(20)      NOT NULL AUTO_INCREMENT    COMMENT 'æ–°é—»ID',
  title           varchar(200)    NOT NULL                   COMMENT 'æ ‡é¢˜',
  summary         varchar(500)    DEFAULT ''                 COMMENT 'æ‘˜è¦',
  content         text                                       COMMENT 'å†…å®¹',
  category        varchar(50)     DEFAULT ''                 COMMENT 'åˆ†ç±»',
  image_url       varchar(500)    DEFAULT ''                 COMMENT 'å›¾ç‰‡åœ°å€',
  is_featured     char(1)         DEFAULT '0'                COMMENT 'æ˜¯å¦å¤´æ¡ï¼ˆ0å¦ 1æ˜¯ï¼‰',
  views           int(11)         DEFAULT 0                  COMMENT 'é˜…è¯»é‡',
  status          char(1)         DEFAULT '0'                COMMENT 'çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  create_by       varchar(64)     DEFAULT ''                 COMMENT 'åˆ›å»ºè€…',
  create_time     datetime                                   COMMENT 'åˆ›å»ºæ—¶é—´',
  update_by       varchar(64)     DEFAULT ''                 COMMENT 'æ›´æ–°è€…',
  update_time     datetime                                   COMMENT 'æ›´æ–°æ—¶é—´',
  remark          varchar(500)    DEFAULT NULL               COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (news_id)
) ENGINE=InnoDB AUTO_INCREMENT=1 COMMENT = 'æ–°é—»è¡¨';
```

## ğŸ›¡ï¸ é˜²åˆ·æœºåˆ¶

### 1. é˜²åˆ·ç­–ç•¥

#### IP + æ—¶é—´çª—å£é™åˆ¶
- **åŒä¸€IPé™åˆ¶**ï¼šåŒä¸€IPåœ°å€åœ¨æŒ‡å®šæ—¶é—´å†…åªèƒ½ä¸ºåŒä¸€æ–‡ç« å¢åŠ ä¸€æ¬¡é˜…è¯»é‡
- **æ—¶é—´çª—å£**ï¼š1å°æ—¶å†…ä¸èƒ½é‡å¤å¢åŠ é˜…è¯»é‡ï¼ˆæ¼”ç¤ºæ¨¡å¼ä¸º10ç§’ï¼‰
- **ç²¾ç¡®è¯†åˆ«**ï¼šæ”¯æŒä»£ç†ç¯å¢ƒä¸‹çš„çœŸå®IPè·å–

#### é˜²åˆ·æµç¨‹
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant B as åç«¯
    participant R as Redis
    
    U->>F: ç‚¹å‡»æ–°é—»
    F->>B: POST /website/news/views/{newsId}
    B->>B: è·å–å®¢æˆ·ç«¯IP
    B->>R: æ£€æŸ¥é˜²åˆ·é™åˆ¶key
    alt å·²è®¿é—®è¿‡
        R-->>B: è¿”å›é™åˆ¶çŠ¶æ€
        B-->>F: è¿”å›å½“å‰é˜…è¯»é‡ï¼ˆä¸å¢åŠ ï¼‰
    else é¦–æ¬¡è®¿é—®
        B->>R: è®¾ç½®é˜²åˆ·é™åˆ¶
        B->>R: å¢åŠ é˜…è¯»é‡
        R-->>B: è¿”å›æ–°é˜…è¯»é‡
        B-->>F: è¿”å›æ–°é˜…è¯»é‡
    end
    F->>F: æ›´æ–°æœ¬åœ°æ˜¾ç¤º
```

### 2. é˜²åˆ·é…ç½®

#### æ¼”ç¤ºæ¨¡å¼é…ç½®
```java
// æ¼”ç¤ºæ¨¡å¼å¼€å…³ï¼ˆtrue=æ¼”ç¤ºæ¨¡å¼ï¼Œfalse=ç”Ÿäº§æ¨¡å¼ï¼‰
private static final boolean DEMO_MODE = true;

// é˜²åˆ·é™åˆ¶è¿‡æœŸæ—¶é—´
// æ¼”ç¤ºæ¨¡å¼ï¼š10ç§’ï¼Œç”Ÿäº§æ¨¡å¼ï¼š1å°æ—¶
private static final long VIEW_LIMIT_EXPIRE = DEMO_MODE ? 10 : 60 * 60;
```

#### Redis Keyè®¾è®¡
```
é˜²åˆ·é™åˆ¶Keyæ ¼å¼ï¼šnews:view_limit:{clientIp}:{newsId}
é˜…è¯»é‡Keyæ ¼å¼ï¼šnews:views:{newsId}
```

### 3. é˜²åˆ·æ•ˆæœ

#### æ­£å¸¸ç”¨æˆ·è¡Œä¸º
```
æ—¶é—´è½´ï¼š
00:00 - ç”¨æˆ·ç‚¹å‡»æ–°é—»A â†’ é˜…è¯»é‡: 100 â†’ 101 âœ…
00:05 - ç”¨æˆ·å†æ¬¡ç‚¹å‡»æ–°é—»A â†’ é˜…è¯»é‡: 101 (ä¸å˜) ğŸ›¡ï¸
00:15 - ç”¨æˆ·ç‚¹å‡»æ–°é—»A â†’ é˜…è¯»é‡: 101 â†’ 102 âœ…
```

#### æ¶æ„åˆ·é‡è¡Œä¸º
```
æ—¶é—´è½´ï¼š
00:00 - æ¶æ„ç”¨æˆ·ç‚¹å‡»æ–°é—»A â†’ é˜…è¯»é‡: 100 â†’ 101 âœ…
00:01 - æ¶æ„ç”¨æˆ·å†æ¬¡ç‚¹å‡» â†’ é˜…è¯»é‡: 101 (ä¸å˜) ğŸ›¡ï¸
00:02 - æ¶æ„ç”¨æˆ·å†æ¬¡ç‚¹å‡» â†’ é˜…è¯»é‡: 101 (ä¸å˜) ğŸ›¡ï¸
00:03 - æ¶æ„ç”¨æˆ·å†æ¬¡ç‚¹å‡» â†’ é˜…è¯»é‡: 101 (ä¸å˜) ğŸ›¡ï¸
...
00:10 - æ¶æ„ç”¨æˆ·å†æ¬¡ç‚¹å‡» â†’ é˜…è¯»é‡: 101 â†’ 102 âœ…
```

## ğŸ”„ æ•°æ®æµç¨‹

### 1. ç”¨æˆ·ç‚¹å‡»æ–°é—»æµç¨‹
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant B as åç«¯
    participant R as Redis
    participant D as MySQL
    
    U->>F: ç‚¹å‡»æ–°é—»
    F->>B: POST /website/news/views/{newsId}
    B->>R: INCR news:views:{newsId}
    R-->>B: è¿”å›æ–°é˜…è¯»é‡
    B-->>F: è¿”å›æˆåŠŸå“åº”
    F->>F: æ›´æ–°æœ¬åœ°é˜…è¯»é‡æ˜¾ç¤º
    F->>F: é‡æ–°è®¡ç®—çƒ­ç‚¹æ’è¡Œ
```

### 2. å®šæ—¶åŒæ­¥æµç¨‹
```mermaid
sequenceDiagram
    participant T as å®šæ—¶ä»»åŠ¡
    participant S as æœåŠ¡å±‚
    participant R as Redis
    participant D as MySQL
    
    T->>S: æ¯5åˆ†é’Ÿæ‰§è¡ŒåŒæ­¥
    S->>R: è·å–æ‰€æœ‰ news:views:* é”®
    R-->>S: è¿”å›é”®åˆ—è¡¨
    loop éå†æ¯ä¸ªé”®
        S->>R: è·å–é˜…è¯»é‡å€¼
        R-->>S: è¿”å›é˜…è¯»é‡
        S->>D: æ›´æ–°æ•°æ®åº“é˜…è¯»é‡
    end
    S-->>T: åŒæ­¥å®Œæˆ
```

### 3. æ•°æ®è¯»å–æµç¨‹
```mermaid
sequenceDiagram
    participant F as å‰ç«¯
    participant B as åç«¯
    participant R as Redis
    participant D as MySQL
    
    F->>B: è·å–æ–°é—»åˆ—è¡¨
    B->>D: æŸ¥è¯¢æ–°é—»æ•°æ®
    D-->>B: è¿”å›æ–°é—»åˆ—è¡¨
    loop éå†æ¯ä¸ªæ–°é—»
        B->>R: è·å–é˜…è¯»é‡
        alt Redisä¸­æœ‰æ•°æ®
            R-->>B: è¿”å›é˜…è¯»é‡
        else Redisä¸­æ— æ•°æ®
            B->>D: æŸ¥è¯¢æ•°æ®åº“é˜…è¯»é‡
            D-->>B: è¿”å›é˜…è¯»é‡
            B->>R: åŒæ­¥åˆ°Redis
        end
    end
    B-->>F: è¿”å›å®Œæ•´æ–°é—»æ•°æ®
```

## ğŸ’» ä»£ç å®ç°

### 1. å‰ç«¯æ ¸å¿ƒä»£ç 

#### æ–°é—»ç‚¹å‡»å¤„ç†
```javascript
// å¤„ç†æ–°é—»ç‚¹å‡»
handleNewsClick(news) {
  // å¢åŠ é˜…è¯»é‡
  this.incrementViews(news.newsId)
  
  this.selectedNews = news
  this.dialogVisible = true
},

// å¢åŠ é˜…è¯»é‡
async incrementViews(newsId) {
  try {
    const response = await incrementNewsViews(newsId)
    // æ ¹æ®åç«¯è¿”å›çš„å®é™…é˜…è¯»é‡æ›´æ–°æœ¬åœ°æ˜¾ç¤º
    this.updateLocalViews(newsId, response.data)
  } catch (error) {
    console.warn('å¢åŠ é˜…è¯»é‡å¤±è´¥:', error)
  }
},

// æ›´æ–°æœ¬åœ°é˜…è¯»é‡æ˜¾ç¤º
updateLocalViews(newsId, actualViews) {
  const news = this.newsList.find(item => item.newsId === newsId)
  if (news) {
    // ä½¿ç”¨åç«¯è¿”å›çš„å®é™…é˜…è¯»é‡ï¼Œè€Œä¸æ˜¯ç®€å•+1
    news.views = actualViews || news.views
  }
}
```

#### é˜…è¯»é‡æ ¼å¼åŒ–
```javascript
// æ ¼å¼åŒ–é˜…è¯»é‡
formatViews(views) {
  if (!views) return '0'
  if (views >= 10000) {
    return (views / 10000).toFixed(1) + 'ä¸‡'
  } else if (views >= 1000) {
    return (views / 1000).toFixed(1) + 'k'
  }
  return views.toString()
}
```

### 2. åç«¯æ ¸å¿ƒä»£ç 

#### Rediså·¥å…·ç±»æ‰©å±•
```java
// RedisCache.java æ–°å¢æ–¹æ³•
/**
 * é€’å¢
 */
public Long increment(final String key) {
    return redisTemplate.opsForValue().increment(key);
}

/**
 * é€’å¢æŒ‡å®šå€¼
 */
public Long increment(final String key, final long delta) {
    return redisTemplate.opsForValue().increment(key, delta);
}
```

#### æ•°æ®åº“æ˜ å°„
```xml
<!-- WebsiteNewsMapper.xml -->
<update id="updateWebsiteNewsViews" parameterType="WebsiteNews">
    update website_news 
    set views = #{views}
    where news_id = #{newsId}
</update>
```

## âš™ï¸ é…ç½®è¯´æ˜

### 1. å®šæ—¶ä»»åŠ¡é…ç½®

#### é€šè¿‡åå°ç®¡ç†ç•Œé¢é…ç½®
1. è®¿é—® `http://localhost/monitor/job`
2. ç‚¹å‡»"æ–°å¢"æŒ‰é’®
3. å¡«å†™é…ç½®ä¿¡æ¯ï¼š
   ```
   ä»»åŠ¡åç§°ï¼šæ–°é—»é˜…è¯»é‡åŒæ­¥
   ä»»åŠ¡ç»„åï¼šDEFAULT
   è°ƒç”¨ç›®æ ‡å­—ç¬¦ä¸²ï¼šryTask.syncNewsViews
   cronæ‰§è¡Œè¡¨è¾¾å¼ï¼š0 */5 * * * ?
   è®¡åˆ’æ‰§è¡Œé”™è¯¯ç­–ç•¥ï¼šæ”¾å¼ƒæ‰§è¡Œ
   æ˜¯å¦å¹¶å‘æ‰§è¡Œï¼šç¦æ­¢
   çŠ¶æ€ï¼šæ­£å¸¸
   å¤‡æ³¨ï¼šæ¯5åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æ–°é—»é˜…è¯»é‡æ•°æ®ä»Redisåˆ°MySQL
   ```

#### é€šè¿‡SQLè„šæœ¬é…ç½®
```sql
INSERT INTO sys_job VALUES(
    4, 
    'æ–°é—»é˜…è¯»é‡åŒæ­¥', 
    'DEFAULT', 
    'ryTask.syncNewsViews', 
    '0 */5 * * * ?', 
    '3', 
    '1', 
    '0', 
    'admin', 
    sysdate(), 
    '', 
    null, 
    'æ¯5åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æ–°é—»é˜…è¯»é‡æ•°æ®ä»Redisåˆ°MySQL'
);
```

### 2. æ¨¡å—ä¾èµ–é…ç½®

#### ruoyi-quartz/pom.xml
```xml
<!-- æ·»åŠ ç³»ç»Ÿæ¨¡å—ä¾èµ– -->
<dependency>
    <groupId>com.ruoyi</groupId>
    <artifactId>ruoyi-system</artifactId>
</dependency>
```

### 3. æƒé™é…ç½®

#### ç™½åå•é…ç½® (permission.js)
```javascript
const whiteList = [
  '/login', 
  '/register', 
  '/website/home', 
  '/website/about', 
  '/website/services', 
  '/website/facilities', 
  '/website/news-display', 
  '/website/contact', 
  '/website/appointment', 
  '/website/family-login'
]
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•

#### é˜…è¯»é‡ç»Ÿè®¡æµ‹è¯•
1. **ç‚¹å‡»æ–°é—»**ï¼šç‚¹å‡»ä»»æ„æ–°é—»ï¼Œæ£€æŸ¥é˜…è¯»é‡æ˜¯å¦+1
2. **å®æ—¶æ›´æ–°**ï¼šæ£€æŸ¥çƒ­ç‚¹æ’è¡Œæ˜¯å¦å®æ—¶æ›´æ–°æ’åº
3. **æ•°æ®æŒä¹…åŒ–**ï¼šé‡å¯åº”ç”¨åæ£€æŸ¥é˜…è¯»é‡æ˜¯å¦ä¿æŒ

#### é˜²åˆ·æœºåˆ¶æµ‹è¯•
1. **æ­£å¸¸ç‚¹å‡»**ï¼šç¬¬ä¸€æ¬¡ç‚¹å‡»æ–°é—»ï¼Œé˜…è¯»é‡æ­£å¸¸å¢åŠ 
2. **é‡å¤ç‚¹å‡»**ï¼šç«‹å³é‡å¤ç‚¹å‡»åŒä¸€æ–°é—»ï¼Œé˜…è¯»é‡ä¸å˜
3. **æ—¶é—´çª—å£**ï¼šç­‰å¾…é™åˆ¶æ—¶é—´åå†æ¬¡ç‚¹å‡»ï¼Œé˜…è¯»é‡å¯ä»¥å¢åŠ 
4. **ä¸åŒIP**ï¼šä½¿ç”¨ä¸åŒIPè®¿é—®ï¼Œé˜…è¯»é‡æ­£å¸¸å¢åŠ 
5. **å‰åç«¯åŒæ­¥**ï¼šæ£€æŸ¥å‰ç«¯æ˜¾ç¤ºä¸åç«¯å®é™…å€¼æ˜¯å¦ä¸€è‡´

#### å®šæ—¶åŒæ­¥æµ‹è¯•
1. **æ‰‹åŠ¨è§¦å‘**ï¼šåœ¨åå°ç®¡ç†ç•Œé¢æ‰‹åŠ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡
2. **è‡ªåŠ¨æ‰§è¡Œ**ï¼šç­‰å¾…5åˆ†é’Ÿæ£€æŸ¥æ˜¯å¦è‡ªåŠ¨åŒæ­¥
3. **æ•°æ®ä¸€è‡´æ€§**ï¼šæ£€æŸ¥Rediså’ŒMySQLæ•°æ®æ˜¯å¦ä¸€è‡´

### 2. æ€§èƒ½æµ‹è¯•

#### å¹¶å‘æµ‹è¯•
```bash
# ä½¿ç”¨abå·¥å…·è¿›è¡Œå¹¶å‘æµ‹è¯•
ab -n 1000 -c 100 http://localhost/website/news/views/1
```

#### å‹åŠ›æµ‹è¯•
- **ç›®æ ‡**ï¼šæ”¯æŒ1000+å¹¶å‘ç”¨æˆ·
- **å“åº”æ—¶é—´**ï¼š< 100ms
- **æ•°æ®å‡†ç¡®æ€§**ï¼š100%å‡†ç¡®

### 3. ç›‘æ§æŒ‡æ ‡

#### å…³é”®æŒ‡æ ‡
- **Rediså‘½ä¸­ç‡**ï¼š> 95%
- **åŒæ­¥å»¶è¿Ÿ**ï¼š< 5åˆ†é’Ÿ
- **é”™è¯¯ç‡**ï¼š< 0.1%
- **å“åº”æ—¶é—´**ï¼š< 100ms

## â“ å¸¸è§é—®é¢˜

### 1. ç¼–è¯‘é”™è¯¯

#### é—®é¢˜ï¼šæ¨¡å—ä¾èµ–é”™è¯¯
```
java: ç¨‹åºåŒ…com.ruoyi.system.serviceä¸å­˜åœ¨
```
**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨`ruoyi-quartz/pom.xml`ä¸­æ·»åŠ å¯¹`ruoyi-system`çš„ä¾èµ–

#### é—®é¢˜ï¼šç±»å‹è½¬æ¢é”™è¯¯
```
java: ä¸å…¼å®¹çš„ç±»å‹: java.util.Collection<java.lang.String>æ— æ³•è½¬æ¢ä¸ºjava.util.Set<java.lang.String>
```
**è§£å†³æ–¹æ¡ˆ**ï¼šå°†`Set<String>`æ”¹ä¸º`Collection<String>`

### 2. è¿è¡Œæ—¶é”™è¯¯

#### é—®é¢˜ï¼šRedisè¿æ¥å¤±è´¥
```
Could not get a resource from the pool
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥RedisæœåŠ¡æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥Redisé…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

#### é—®é¢˜ï¼šå®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥cronè¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ä»»åŠ¡çŠ¶æ€æ˜¯å¦ä¸º"æ­£å¸¸"

### 3. æ•°æ®é—®é¢˜

#### é—®é¢˜ï¼šé˜…è¯»é‡ä¸å‡†ç¡®
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥Redisæ•°æ®æ˜¯å¦æ­£å¸¸
2. æ£€æŸ¥å®šæ—¶åŒæ­¥æ˜¯å¦æ‰§è¡Œ
3. æ£€æŸ¥æ•°æ®åº“æ›´æ–°æ˜¯å¦æˆåŠŸ

#### é—®é¢˜ï¼šçƒ­ç‚¹æ’è¡Œä¸æ›´æ–°
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å‰ç«¯è®¡ç®—å±æ€§æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ•°æ®ç»‘å®šæ˜¯å¦æ­£å¸¸
3. æ£€æŸ¥Vueå“åº”å¼æ›´æ–°

#### é—®é¢˜ï¼šé˜²åˆ·æœºåˆ¶ä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥Redisè¿æ¥æ˜¯å¦æ­£å¸¸
2. æ£€æŸ¥é˜²åˆ·é™åˆ¶Keyæ˜¯å¦æ­£ç¡®è®¾ç½®
3. æ£€æŸ¥æ—¶é—´çª—å£é…ç½®æ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥IPè·å–é€»è¾‘æ˜¯å¦å‡†ç¡®

#### é—®é¢˜ï¼šå‰ç«¯æ˜¾ç¤ºä¸åç«¯ä¸ä¸€è‡´
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å‰ç«¯æ˜¯å¦æ­£ç¡®ä½¿ç”¨åç«¯è¿”å›çš„å®é™…é˜…è¯»é‡
2. æ£€æŸ¥APIå“åº”æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥å‰ç«¯æ›´æ–°é€»è¾‘æ˜¯å¦åˆç†

## ğŸ“š å­¦ä¹ è¦ç‚¹

### 1. æŠ€æœ¯è¦ç‚¹
- **RedisåŸå­æ“ä½œ**ï¼šä½¿ç”¨INCRç¡®ä¿å¹¶å‘å®‰å…¨
- **Vueè®¡ç®—å±æ€§**ï¼šå®ç°å“åº”å¼æ•°æ®æ›´æ–°
- **Springå®šæ—¶ä»»åŠ¡**ï¼šQuartzæ¡†æ¶çš„ä½¿ç”¨
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå‰åç«¯åˆ†ç¦»æ¶æ„
- **é˜²åˆ·æœºåˆ¶**ï¼šIPé™åˆ¶å’Œæ—¶é—´çª—å£æ§åˆ¶
- **å‰åç«¯åŒæ­¥**ï¼šç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### 2. ä¸šåŠ¡è¦ç‚¹
- **ç”¨æˆ·ä½“éªŒ**ï¼šå®æ—¶æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°
- **æ•°æ®ä¸€è‡´æ€§**ï¼šRedisç¼“å­˜ + MySQLæŒä¹…åŒ–
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜ç­–ç•¥ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›
- **å®¹é”™å¤„ç†**ï¼šå¼‚å¸¸æƒ…å†µä¸‹çš„é™çº§å¤„ç†
- **æ•°æ®çœŸå®æ€§**ï¼šé˜²åˆ·æœºåˆ¶ç¡®ä¿é˜…è¯»é‡çœŸå®å¯é 
- **å®‰å…¨é˜²æŠ¤**ï¼šé˜²æ­¢æ¶æ„åˆ·é‡ï¼Œä¿æŠ¤ç³»ç»Ÿç¨³å®š

### 3. æ‰©å±•æ–¹å‘
- **åˆ†å¸ƒå¼éƒ¨ç½²**ï¼šRedisé›†ç¾¤ï¼Œæ•°æ®åº“ä¸»ä»
- **ç›‘æ§å‘Šè­¦**ï¼šæ·»åŠ ä¸šåŠ¡ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦
- **æ•°æ®åˆ†æ**ï¼šé˜…è¯»é‡è¶‹åŠ¿åˆ†æï¼Œç”¨æˆ·è¡Œä¸ºåˆ†æ
- **ç¼“å­˜ä¼˜åŒ–**ï¼šLRUç­–ç•¥ï¼Œè¿‡æœŸæ—¶é—´ä¼˜åŒ–

---

## ğŸ“ æ€»ç»“

çƒ­ç‚¹æ–‡ç« å®æ—¶æ›´æ–°ä¸šåŠ¡æ˜¯ä¸€ä¸ªå…¸å‹çš„**é«˜å¹¶å‘ã€å®æ—¶æ€§è¦æ±‚é«˜**çš„ä¸šåŠ¡åœºæ™¯ã€‚é€šè¿‡Redisç¼“å­˜ + MySQLæŒä¹…åŒ–çš„æ¶æ„ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½ï¼Œåˆç¡®ä¿äº†æ•°æ®çš„å¯é æ€§ã€‚å‰ç«¯ä½¿ç”¨Vueçš„å“åº”å¼ç‰¹æ€§å®ç°å®æ—¶æ›´æ–°ï¼Œåç«¯é€šè¿‡å®šæ—¶ä»»åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæ•´ä¸ªç³»ç»Ÿè®¾è®¡åˆç†ï¼Œæ‰©å±•æ€§å¼ºã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸš€ **é«˜æ€§èƒ½**ï¼šRedisç¼“å­˜ï¼Œæ”¯æŒé«˜å¹¶å‘
- ğŸ”„ **å®æ—¶æ€§**ï¼šç‚¹å‡»å³æ›´æ–°ï¼Œç”¨æˆ·ä½“éªŒå¥½
- ğŸ›¡ï¸ **å¯é æ€§**ï¼šæ•°æ®æŒä¹…åŒ–ï¼Œä¸ä¼šä¸¢å¤±
- ğŸ“ˆ **å¯æ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- ğŸ”’ **å®‰å…¨æ€§**ï¼šé˜²åˆ·æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çœŸå®
- âš–ï¸ **ä¸€è‡´æ€§**ï¼šå‰åç«¯æ•°æ®å®Œå…¨åŒæ­¥

è¿™ä¸ªä¸šåŠ¡å®ç°å±•ç¤ºäº†ç°ä»£Webåº”ç”¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œå€¼å¾—æ·±å…¥å­¦ä¹ å’Œåº”ç”¨ã€‚




