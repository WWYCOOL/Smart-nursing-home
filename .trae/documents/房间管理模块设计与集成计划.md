## 模块目标

* 为养老院提供“房间/床位”信息管理、绑定老人、床位状态与价格维护、房间图片管理。

* 与“入住管理”“费用明细”联动，实现入住时绑定床位、自动计提床位费。

## 数据设计

* 新增表：`nur_room`（房间）、`nur_bed`（床位，包含当前绑定老人与状态）、`nur_room_photo`（房间多图）。

* 状态字典：房间状态、床位状态（在系统字典中新增类型与数据）。

* 兼容 RuoYi 通用审计字段：`create_by/create_time/update_by/update_time/del_flag/remark`。

## 代码生成

* 使用 RuoYi 代码生成器分别为三张表生成 CRUD（列表、查询、新增、编辑、删除、导出）。

* 列表页联动：房间列表进入床位列表；床位列表支持绑定/解绑老人、状态切换、价格维护。

* 图片上传：房间详情页支持上传多图并设置封面（`nur_room_photo`）。

## 业务流程

* 绑定老人：在床位详情中选择老人并保存，更新`nur_bed.elder_id/bed_status/bind_time`。

* 解绑/退住：清空`elder_id`，更新`bed_status`为“空闲”，记录解绑时间。

* 维护价格：`nur_bed.bed_price`为床位费基础价格；房间层面`nur_room.room_price`用于参考或差异化管理。

## 入住管理改造

* 入住选择床位：在入住流程中增加“选床位”，保存后更新床位与入住记录的关联。

* 退住处理：退住时自动释放床位并更新状态。

* 预留逻辑：支持将床位状态置为“预留”，允许一定时间窗口后自动回收或转入住。

## 费用明细自动计提

* 触发点：入住成功后生成首期“床位费”费用明细；周期性任务按天/月计提（可配置）。

* 计费方式：

  * 日计费：`bed_price`×入住天数；退住或换床按天数结算。

  * 月计费：当月在住则生成当月床位费（可支持按入住/退住日期的比例计费）。

* 数据落表：向现有“费用明细”表插入一条类型为“床位费”的记录，关联床位与老人。

## 权限与数据安全

* 菜单与权限：为房间/床位/房间图片增加独立菜单与权限标识。

* 数据权限：按院区/楼栋（如有）设置数据范围；操作留痕通过审计字段。

## 测试与验收

* 单元测试：床位状态流转、绑定/解绑、价格计算的核心用例。

* 集成测试：入住→选床→自动计费→退住的端到端流程。

* 回归检查：费用汇总、对账报表不受影响。

## 迭代建议

* 后续新增`nur_bed_assign`历史表记录每次床位占用区间，支持报表统计。

* 增强房间照片的排序与封面管理；支持多床位批量操作。

